(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{117:function(t,e,a){"use strict";a.r(e),function(t){var e=a(51),i=a(52),n=a.n(i),o=(a(198),a(114)),s=a.n(o),r=a(115),u=a.n(r),c=a(116);a(199);function d(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var p=new s.a;var v=function(){function t(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=a.speed,n=void 0===i?50:i,o=a.voice,s=void 0===o?50:o,r=a.pitch,u=void 0===r?50:r,c=a.engineType,h=void 0===c?"intp65":c,f=a.voiceName,v=void 0===f?"xiaoyan":f,y=a.appId,w=void 0===y?"":y,S=a.apiKey,b=void 0===S?"":S,g=a.apiSecret,m=void 0===g?"":g,A=a.text,T=void 0===A?"":A,k=a.tte,x=void 0===k?"UTF8":k,D=a.defaultText,C=void 0===D?"请输入您要合成的文本":D;l(this,t),this.speed=n,this.voice=s,this.pitch=u,this.engineType=h,this.voiceName=v,this.text=T,this.tte=x,this.defaultText=C,this.appId=w,this.apiKey=b,this.apiSecret=m,this.audioData=[],this.rawAudioData=[],this.audioDataOffset=0,this.status="init",p.onmessage=function(t){var a,i;(a=e.audioData).push.apply(a,d(t.data.data)),(i=e.rawAudioData).push.apply(i,d(t.data.rawAudioData))}}var e,a,i;return e=t,(a=[{key:"setApp",value:function(t){var e=t.appId,a=t.apiKey,i=t.apiSecret;e&&(this.appId=e),a&&(this.apiKey=a),i&&(this.apiSecret=i)}},{key:"setStatus",value:function(t){this.onWillStatusChange&&this.onWillStatusChange(this.status,t),this.status=t}},{key:"setParams",value:function(t){var e=t.speed,a=t.voice,i=t.pitch,n=t.text,o=t.engineType,s=t.voiceName,r=t.tte;void 0!==e&&(this.speed=e),void 0!==a&&(this.voice=a),void 0!==i&&(this.pitch=i),n&&(this.text=n),r&&(this.tte=r),o&&(this.engineType=o),s&&(this.voiceName=s),this.resetAudio()}},{key:"connectWebSocket",value:function(t,e){var a,i,o=this;return this.setStatus("ttsing"),(a=t,i=e,new Promise((function(t,e){var o=a,s=i,r="wss://tts-api.xfyun.cn/v2/tts",u=location.host,c=(new Date).toGMTString(),d="host: ".concat(u,"\ndate: ").concat(c,"\nGET /v2/tts HTTP/1.1"),h=n.a.HmacSHA256(d,s),l=n.a.enc.Base64.stringify(h),f='api_key="'.concat(o,'", algorithm="').concat("hmac-sha256",'", headers="').concat("host date request-line",'", signature="').concat(l,'"'),p=btoa(f);t(r="".concat(r,"?authorization=").concat(p,"&date=").concat(c,"&host=").concat(u))}))).then((function(t){var e;if("WebSocket"in window)e=new WebSocket(t);else{if(!("MozWebSocket"in window))return void alert("浏览器不支持WebSocket");e=new MozWebSocket(t)}o.ttsWS=e,e.onopen=function(t){o.webSocketSend(),o.playTimeout=setTimeout((function(){o.audioPlay()}),1e3)},e.onmessage=function(t){o.result(t.data)},e.onerror=function(e){clearTimeout(o.playTimeout),o.setStatus("errorTTS"),alert("WebSocket报错，请f12查看详情"),console.error("详情查看：".concat(encodeURI(t.replace("wss:","https:"))))},e.onclose=function(t){console.log(t)}}))}},{key:"transToAudioData",value:function(t){}},{key:"webSocketSend",value:function(){var t={common:{app_id:this.appId},business:{ent:this.engineType,aue:"raw",auf:"audio/L16;rate=16000",vcn:this.voiceName,speed:this.speed,volume:this.voice,pitch:this.pitch,bgs:1,tte:this.tte},data:{status:2,text:this.encodeText(this.text||this.defaultText,"unicode"===this.tte?"base64&utf16le":"")}};this.ttsWS.send(JSON.stringify(t))}},{key:"encodeText",value:function(t,e){switch(e){case"utf16le":for(var a=new ArrayBuffer(4*t.length),i=new Uint16Array(a),n=0,o=t.length;n<o;n++)i[n]=t.charCodeAt(n);return a;case"buffer2Base64":for(var s="",r=new Uint8Array(t),u=r.byteLength,d=0;d<u;d++)s+=String.fromCharCode(r[d]);return window.btoa(s);case"base64&utf16le":return this.encodeText(this.encodeText(t,"utf16le"),"buffer2Base64");default:return c.Base64.encode(t)}}},{key:"result",value:function(t){var e=JSON.parse(t);if(0!==e.code)return alert("合成失败: ".concat(e.code,":").concat(e.message)),console.error("".concat(e.code,":").concat(e.message)),void this.resetAudio();p.postMessage(e.data.audio),0===e.code&&2===e.data.status&&this.ttsWS.close()}},{key:"resetAudio",value:function(){this.audioStop(),this.setStatus("init"),this.audioDataOffset=0,this.audioData=[],this.rawAudioData=[],this.ttsWS&&this.ttsWS.close(),clearTimeout(this.playTimeout)}},{key:"audioInit",value:function(){var t=window.AudioContext||window.webkitAudioContext;t&&(this.audioContext=new t,this.audioContext.resume(),this.audioDataOffset=0)}},{key:"audioPlay",value:function(){var t=this;this.setStatus("play");var e=this.audioData.slice(this.audioDataOffset);this.audioDataOffset+=e.length;var a=this.audioContext.createBuffer(1,e.length,22050),i=a.getChannelData(0);if(a.copyToChannel)a.copyToChannel(new Float32Array(e),0,0);else for(var n=0;n<e.length;n++)i[n]=e[n];var o=this.bufferSource=this.audioContext.createBufferSource();o.buffer=a,o.connect(this.audioContext.destination),o.start(),o.onended=function(e){"play"===t.status&&(t.audioDataOffset<t.audioData.length?t.audioPlay():t.audioStop())}}},{key:"audioStop",value:function(){if(this.setStatus("endPlay"),clearTimeout(this.playTimeout),this.audioDataOffset=0,this.bufferSource)try{this.bufferSource.stop()}catch(t){console.log(t)}}},{key:"start",value:function(){if(this.appId)if(this.apiKey)if(this.apiSecret)if(this.audioData.length)this.audioPlay();else{if(this.audioContext||this.audioInit(),!this.audioContext)return void alert("该浏览器不支持webAudioApi相关接口");this.connectWebSocket(this.apiKey,this.apiSecret)}else alert("请输入 api secret");else alert("请输入 api key");else alert("请输入 app id")}},{key:"stop",value:function(){this.audioStop()}}])&&f(e.prototype,a),i&&f(e,i),t}(),y=(new u.a,new v);y.onWillStatusChange=function(e,a){t(".audio-ctrl-btn").removeClass(e).addClass(a).text({init:"立即合成",ttsing:"正在合成",play:"停止播放",endPlay:"重新播放",errorTTS:"合成失败"}[a])},t(".audio-ctrl-btn").click((function(){["init","endPlay","errorTTS"].indexOf(y.status)>-1?y.start():y.stop()})),t(".download-wav").click((function(){y.rawAudioData.length?Object(e.b)(new DataView(new Int16Array(y.rawAudioData).buffer),16e3,16):alert("请先合成")})),t(".download-pcm").click((function(){y.rawAudioData.length?Object(e.a)(new Int16Array(y.rawAudioData)):alert("请先合成")})),t("#input_text").change((function(){y.setParams({text:this.value})})),t("#app-id").change((function(){y.setApp({appId:this.value})})),t("#api-key").change((function(){y.setApp({apiKey:this.value})})),t("#api-secret").change((function(){y.setApp({apiSecret:this.value})})),t((function(){y.setApp({appId:t("#app-id").value,apiKey:t("#api-key").value,apiSecret:t("#api-secret").value})}))}.call(this,a(118))},199:function(t,e,a){var i=a(200);"string"==typeof i&&(i=[[t.i,i,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};a(201)(i,n);i.locals&&(t.exports=i.locals)},200:function(t,e,a){}},[[203,3,2,0]]]);